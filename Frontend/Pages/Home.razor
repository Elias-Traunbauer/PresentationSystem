@page "/"
@using Frontend.Models
@inject HttpClient Http

<PageTitle>Home</PageTitle>

<h1>Presentation Overview</h1>

@code{
    public IEnumerable<Presentation>? Presentations = null;
    public bool Loading = true;
    public DateOnly SelectedDate = DateOnly.FromDateTime(DateTime.Now);
    public DateOnly SelectedMonth = DateOnly.FromDateTime(DateTime.Now);
    public int DaysFromPreviousMonthDisplayed {
        get
        {
            // takes the day cnt of the selected month, 
            // Math.Floor((35 - selectedmonthdaycnt) / 2)
            int daysInMonth = DateTime.DaysInMonth(SelectedMonth.Year, SelectedMonth.Month);
            return (int)Math.Floor((35 - daysInMonth) / 2f);
        }
    }

    public void PreviousMonth()
    {
        SelectedMonth = SelectedMonth.AddMonths(-1);
        StateHasChanged();
    }

    public void NextMonth()
    {
        SelectedMonth = SelectedMonth.AddMonths(1);
        StateHasChanged();
    }
}

@{
    if (Presentations == null && Loading)
    {
        <p><em>Loading...</em></p>
    }
    else if (Presentations != null)
    { // calendar view
        <button @onclick="PreviousMonth">Previous Month</button>
        <button @onclick="NextMonth">Next Month</button>
        DateOnly current = new DateOnly(SelectedDate.Year, SelectedDate.Month, 1).AddDays(-DaysFromPreviousMonthDisplayed);
        for (int i = 0; i < 35; i++)
        {
            <p>@current.Day</p>
            current = current.AddDays(1);
        }

    }
    else
    {
        <p><em>Loading encountered an error</em></p>
    }
}

@code {
    protected override async Task OnInitializedAsync()
    {
        this.Presentations = await Http.GetFromJsonAsync<IEnumerable<Presentation>>("api/presentation");
        Loading = false;
    }
}